<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>FlagKinect</title></head><body><style>body{font-family:'Meiryo','Hiragino Kaku Gothic Pro',sans-serif} h2{margin-bottom: 0;padding-bottom: 0} h2 img,center img{height: 1.7em; vertical-align: bottom} h2 img{margin-right: .5em} h2 small{font-weight: normal; font-size: smaller;} pre{font-family:'Courier New',Modern,sans-serif} hr{margin-top: .2em;height:1px;border:solid #003f8e;border-width:2px 0;background:#003f8e;}</style><h2><img src="http://junkato.jp/picode/miraikan.png" alt="Miraikan" /><b>Picodeワークショップ</b><small>～カラダをつかってロボットプログラミング！～</small></h2><hr/><pre><font color="#cc3300">//&nbsp;変数の宣言<br></font>Human&nbsp;human;<br>PFont&nbsp;font,&nbsp;smallFont,&nbsp;largeFont;<br>PImage&nbsp;left,&nbsp;right,&nbsp;none,&nbsp;both;<br>Pose&nbsp;pose;<br><font color="purple"><b>int</b></font>&nbsp;start,&nbsp;score,&nbsp;lastScore,&nbsp;count,&nbsp;goal,&nbsp;showCount,&nbsp;time;<br><br><font color="#cc3300">//&nbsp;--------------------------------------------------------------------------------<br></font><font color="#cc3300">//&nbsp;はじめに一度だけ実行される処理<br></font><font color="purple"><b>void</b></font>&nbsp;setup()&nbsp;{<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;Kinectに接続する<br></font>&nbsp;&nbsp;human&nbsp;=&nbsp;<font color="purple"><b>new</b></font>&nbsp;Human();<br>&nbsp;&nbsp;human.showCaptureFrame(<font color="purple"><b>true</b></font>);<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;フォントやキャラクターの画像を読み込む<br></font>&nbsp;&nbsp;font&nbsp;=&nbsp;createFont(&quot;Meiryo&nbsp;UI&nbsp;Bold&quot;,&nbsp;64,&nbsp;<font color="purple"><b>true</b></font>);<br>&nbsp;&nbsp;smallFont&nbsp;=&nbsp;createFont(&quot;Meiryo&nbsp;UI&nbsp;Bold&quot;,&nbsp;32,&nbsp;<font color="purple"><b>true</b></font>);<br>&nbsp;&nbsp;largeFont&nbsp;=&nbsp;createFont(&quot;Meiryo&nbsp;UI&nbsp;Bold&quot;,&nbsp;96,&nbsp;<font color="purple"><b>true</b></font>);<br>&nbsp;&nbsp;left&nbsp;=&nbsp;loadImage(&quot;left.png&quot;);<br>&nbsp;&nbsp;right&nbsp;=&nbsp;loadImage(&quot;right.png&quot;);<br>&nbsp;&nbsp;none&nbsp;=&nbsp;loadImage(&quot;none.png&quot;);<br>&nbsp;&nbsp;both&nbsp;=&nbsp;loadImage(&quot;both.png&quot;);<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;設定など<br></font>&nbsp;&nbsp;frameRate(15);&nbsp;&nbsp;<font color="#cc3300">//&nbsp;draw()を実行する頻度<br></font>&nbsp;&nbsp;size(640,&nbsp;720);&nbsp;<font color="#cc3300">//&nbsp;画面サイズ<br></font>&nbsp;&nbsp;start&nbsp;=&nbsp;-1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;スコアを計算するための現在時刻(ゲーム開始前は仮に&nbsp;-1&nbsp;にしておく)<br></font>&nbsp;&nbsp;score&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;合計スコア(最初はもちろん&nbsp;0)<br></font>&nbsp;&nbsp;lastScore&nbsp;=&nbsp;0;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;最後に正解したとき加算されたスコア<br></font>&nbsp;&nbsp;count&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;正解した回数<br></font>&nbsp;&nbsp;goal&nbsp;=&nbsp;2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;最初の正解ポーズを決める(2:&nbsp;両手をさげて！)<br></font>&nbsp;&nbsp;showCount&nbsp;=&nbsp;0;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;スコアを表示する残り時間(最初は表示しないので&nbsp;0&nbsp;にしておく)<br></font>}<br><br><font color="#cc3300">//&nbsp;--------------------------------------------------------------------------------<br></font><font color="#cc3300">//&nbsp;1秒に15回実行されつづける処理<br></font><font color="purple"><b>void</b></font>&nbsp;draw()&nbsp;{<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;人のポーズを取得する<br></font>&nbsp;&nbsp;pose&nbsp;=&nbsp;human.getPose();<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;画面にキャラクターやスコアを表示する<br></font>&nbsp;&nbsp;showInfo();<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;ポーズが取れなかったらここで終わる<br></font>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;(ポーズの判定に進まない)<br></font>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose&nbsp;==&nbsp;<font color="purple"><b>null</b></font>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>return</b></font>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;ポーズが合っているか判定する<br></font>&nbsp;&nbsp;<font color="purple"><b>boolean</b></font>&nbsp;ok&nbsp;=&nbsp;<font color="purple"><b>false</b></font>;<br>&nbsp;&nbsp;<font color="purple"><b>switch</b></font>&nbsp;(goal)&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;左手あげて！<br></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;0:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose.eq(<a href="./poses/New pose (3).txt"><img src="./poses/New pose (3).jpg" width="160" border="1" /></a>)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;=&nbsp;<font color="purple"><b>true</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;右手あげて！<br></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose.eq(<a href="./poses/New pose (4).txt"><img src="./poses/New pose (4).jpg" width="160" border="1" /></a>)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;=&nbsp;<font color="purple"><b>true</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;両手さげて！<br></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;2:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose.eq(<a href="./poses/New pose (2).txt"><img src="./poses/New pose (2).jpg" width="160" border="1" /></a>)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;=&nbsp;<font color="purple"><b>true</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;両手あげて！<br></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;3:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose.eq(<a href="./poses/New pose (5).txt"><img src="./poses/New pose (5).jpg" width="160" border="1" /></a>)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;=&nbsp;<font color="purple"><b>true</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;ポーズが正しくなかったらここで終わる<br></font>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(ok&nbsp;==&nbsp;<font color="purple"><b>false</b></font>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>return</b></font>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<font color="#cc3300">//&nbsp;正解!!<br></font>&nbsp;&nbsp;calcScore();&nbsp;&nbsp;<font color="#cc3300">//&nbsp;スコアを計算する<br></font>&nbsp;&nbsp;setNewGoal();&nbsp;<font color="#cc3300">//&nbsp;次の正解ポーズを決める<br></font>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(lastScore&nbsp;&gt;&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;showCount&nbsp;=&nbsp;45;&nbsp;<font color="#cc3300">//&nbsp;スコアを表示する残り時間をセットする(45&nbsp;÷&nbsp;15&nbsp;=&nbsp;3秒間)<br></font>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;--------------------------------------------------------------------------------<br></font><font color="#cc3300">//&nbsp;draw()&nbsp;から呼ばれるサブルーチン<br></font><br><font color="#cc3300">//&nbsp;画面にキャラクターやスコアを表示する<br></font><font color="purple"><b>void</b></font>&nbsp;showInfo()&nbsp;{<br>&nbsp;&nbsp;clearBackground();&nbsp;&nbsp;<font color="#cc3300">//&nbsp;背景を塗りつぶす<br></font>&nbsp;&nbsp;showCharacter();&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;キャラクターを表示する<br></font>&nbsp;&nbsp;showTotalScore();&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;スコアの合計を表示する<br></font>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(showCount&nbsp;&gt;=&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;showScore();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cc3300">//&nbsp;最後に正解したときのスコアを表示する<br></font>&nbsp;&nbsp;&nbsp;&nbsp;showCount&nbsp;=&nbsp;showCount&nbsp;-&nbsp;1;&nbsp;<font color="#cc3300">//&nbsp;スコアを表示する残り時間を減らす<br></font>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;背景を塗りつぶす<br></font><font color="purple"><b>void</b></font>&nbsp;clearBackground()&nbsp;{<br>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(pose&nbsp;==&nbsp;<font color="purple"><b>null</b></font>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;background(200);&nbsp;<font color="#cc3300">//&nbsp;ポーズが取れなかったら灰色<br></font>&nbsp;&nbsp;}&nbsp;<font color="purple"><b>else</b></font>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;background(160,&nbsp;216,&nbsp;239);&nbsp;<font color="#cc3300">//&nbsp;取れたら薄青<br></font>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;キャラクターを表示する<br></font><font color="purple"><b>void</b></font>&nbsp;showCharacter()&nbsp;{<br>&nbsp;&nbsp;textFont(font);<br>&nbsp;&nbsp;textAlign(CENTER);<br>&nbsp;&nbsp;<font color="purple"><b>switch</b></font>&nbsp;(goal)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;0:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(left,&nbsp;20,&nbsp;80);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showText(&quot;左手あげて！&quot;,&nbsp;320,&nbsp;640);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(right,&nbsp;20,&nbsp;80);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showText(&quot;右手あげて！&quot;,&nbsp;320,&nbsp;640);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;2:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(none,&nbsp;20,&nbsp;80);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showText(&quot;両手さげて！&quot;,&nbsp;320,&nbsp;640);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>case</b></font>&nbsp;3:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(both,&nbsp;20,&nbsp;80);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showText(&quot;両手あげて！&quot;,&nbsp;320,&nbsp;640);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>break</b></font>;<br>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;文字を表示する<br></font><font color="purple"><b>void</b></font>&nbsp;showText(String&nbsp;text,&nbsp;<font color="purple"><b>int</b></font>&nbsp;x,&nbsp;<font color="purple"><b>int</b></font>&nbsp;y)&nbsp;{<br>&nbsp;&nbsp;showText(text,&nbsp;x,&nbsp;y,&nbsp;color(255,&nbsp;255,&nbsp;255));<br>}<br><font color="purple"><b>void</b></font>&nbsp;showText(String&nbsp;text,&nbsp;<font color="purple"><b>int</b></font>&nbsp;x,&nbsp;<font color="purple"><b>int</b></font>&nbsp;y,&nbsp;<font color="purple"><b>color</b></font>&nbsp;col)&nbsp;{<br>&nbsp;&nbsp;fill(0);<br>&nbsp;&nbsp;text(text,&nbsp;x&nbsp;+&nbsp;1,&nbsp;y&nbsp;+&nbsp;1);<br>&nbsp;&nbsp;text(text,&nbsp;x&nbsp;+&nbsp;2,&nbsp;y&nbsp;+&nbsp;1);<br>&nbsp;&nbsp;text(text,&nbsp;x&nbsp;+&nbsp;1,&nbsp;y&nbsp;+&nbsp;2);<br>&nbsp;&nbsp;fill(col);<br>&nbsp;&nbsp;text(text,&nbsp;x,&nbsp;y);<br>}<br><br><font color="#cc3300">//&nbsp;スコアの合計を表示する<br></font><font color="purple"><b>void</b></font>&nbsp;showTotalScore()&nbsp;{<br>&nbsp;&nbsp;textFont(smallFont);<br>&nbsp;&nbsp;textAlign(LEFT);<br>&nbsp;&nbsp;fill(0);<br>&nbsp;&nbsp;text(&quot;合計スコア:&nbsp;&quot;&nbsp;+&nbsp;score,&nbsp;10,&nbsp;40);<br>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(count&nbsp;&gt;&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>int</b></font>&nbsp;average&nbsp;=&nbsp;time&nbsp;/&nbsp;count;<br>&nbsp;&nbsp;&nbsp;&nbsp;text(&quot;平均反応時間:&nbsp;&quot;&nbsp;+&nbsp;(average&nbsp;/&nbsp;10)&nbsp;+&nbsp;&quot;.&quot;&nbsp;+&nbsp;(average&nbsp;%&nbsp;10)&nbsp;+&nbsp;&quot;秒&quot;,&nbsp;10,&nbsp;80);<br>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;最後に正解したときのスコアを表示する<br></font><font color="purple"><b>void</b></font>&nbsp;showScore()&nbsp;{<br>&nbsp;&nbsp;textFont(largeFont);<br>&nbsp;&nbsp;textAlign(CENTER);<br>&nbsp;&nbsp;showText(&quot;正解！&quot;&nbsp;+&nbsp;lastScore&nbsp;+&nbsp;&quot;点!!&quot;,&nbsp;300,&nbsp;320,&nbsp;color(255,&nbsp;60,&nbsp;60));<br>}<br><br><font color="#cc3300">//&nbsp;スコアを計算する<br></font><font color="purple"><b>void</b></font>&nbsp;calcScore()&nbsp;{<br>&nbsp;&nbsp;<font color="purple"><b>int</b></font>&nbsp;end&nbsp;=&nbsp;getTime();<br>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(start&nbsp;&gt;=&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>int</b></font>&nbsp;lap&nbsp;=&nbsp;end&nbsp;-&nbsp;start;<br>&nbsp;&nbsp;&nbsp;&nbsp;time&nbsp;+=&nbsp;lap;<br>&nbsp;&nbsp;&nbsp;&nbsp;lastScore&nbsp;=&nbsp;100&nbsp;-&nbsp;lap;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(lastScore&nbsp;&lt;&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastScore&nbsp;=&nbsp;0;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;score&nbsp;=&nbsp;score&nbsp;+&nbsp;lastScore;<br>&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;=&nbsp;count&nbsp;+&nbsp;1;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;start&nbsp;=&nbsp;end;<br>}<br><br><font color="#cc3300">//&nbsp;次の正解ポーズを決める<br></font><font color="purple"><b>void</b></font>&nbsp;setNewGoal()&nbsp;{<br>&nbsp;&nbsp;<font color="purple"><b>int</b></font>&nbsp;newGoal&nbsp;=&nbsp;(<font color="purple"><b>int</b></font>)&nbsp;random(0,&nbsp;3);<br>&nbsp;&nbsp;<font color="purple"><b>if</b></font>&nbsp;(goal&nbsp;&lt;=&nbsp;newGoal)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;goal&nbsp;=&nbsp;newGoal&nbsp;+&nbsp;1;<br>&nbsp;&nbsp;}&nbsp;<font color="purple"><b>else</b></font>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;goal&nbsp;=&nbsp;newGoal;<br>&nbsp;&nbsp;}<br>}<br><br><font color="#cc3300">//&nbsp;今の時刻を取得する<br></font><font color="purple"><b>int</b></font>&nbsp;getTime()&nbsp;{<br>&nbsp;&nbsp;<font color="purple"><b>return</b></font>&nbsp;((hour()&nbsp;*&nbsp;60&nbsp;+&nbsp;minute())&nbsp;*&nbsp;60&nbsp;+&nbsp;second())&nbsp;*&nbsp;10&nbsp;+&nbsp;millis()&nbsp;/&nbsp;100;<br>}<br></pre><hr /><center>3/29/2013 <img src="http://junkato.jp/picode/miraikan-header.png" alt="Picodeワークショップ" /></center></body></html>